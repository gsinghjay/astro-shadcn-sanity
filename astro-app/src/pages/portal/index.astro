---
export const prerender = false;

import PortalLayout from "@/layouts/PortalLayout.astro";
import { Icon } from "@/components/ui/icon";
import { Tile, TileContent, TileTitle, TileDescription, TileMedia } from "@/components/ui/tile";
import { Skeleton } from "@/components/ui/skeleton";
import { Badge } from "@/components/ui/badge";

const user = Astro.locals.user;

// TODO (Story 9.2): Look up sponsor by email
// const sponsor = await loadQuery(SPONSOR_BY_EMAIL_QUERY, { email: user?.email });
// if (sponsor) throw Astro.redirect(`/portal/${sponsor.slug}`);

const cards = [
  {
    title: "My Projects",
    description: "View your sponsored capstone projects",
    icon: "lucide:folder",
    href: "/portal/projects",
    disabled: true,
    story: "9.2",
  },
  {
    title: "Upcoming Events",
    description: "See program events and RSVP",
    icon: "lucide:calendar",
    href: "/portal/events",
    disabled: true,
    story: "9.3",
  },
  {
    title: "Submissions",
    description: "Review contact form submissions",
    icon: "lucide:inbox",
    href: "/portal/dashboard",
    disabled: true,
    story: "9.7",
  },
  {
    title: "Site Health",
    description: "Lighthouse & accessibility audit results",
    icon: "lucide:activity",
    href: "/portal/site-health",
    disabled: true,
    story: "9.6",
  },
];
---

<PortalLayout title="Sponsor Portal" activeNav="/portal/">
  <div class="flex flex-col gap-8">
    {/* Welcome heading */}
    <div class="flex flex-col gap-2">
      <h1 class="text-2xl font-bold tracking-tight">Welcome to the Sponsor Portal</h1>
      <p class="text-muted-foreground">
        Signed in as <strong>{user?.email ?? "unknown"}</strong>
      </p>
    </div>

    {/* Skeleton placeholder cards */}
    <div class="grid gap-6 sm:grid-cols-2">
      {cards.map((card) => (
        <Tile variant="floating" class={card.disabled ? "opacity-60 pointer-events-none" : ""}>
          <TileMedia variant="icon">
            <Icon name={card.icon} />
          </TileMedia>
          <TileContent>
            <div class="flex items-center gap-2">
              <TileTitle>{card.title}</TileTitle>
              {card.disabled && (
                <Badge variant="secondary" class="text-2xs">Coming Soon</Badge>
              )}
            </div>
            <TileDescription>{card.description}</TileDescription>
            {/* Skeleton placeholder â€” replaced with real data in Story {card.story} */}
            <div class="mt-3 flex flex-col gap-2">
              <Skeleton class="h-4 w-full" />
              <Skeleton class="h-4 w-3/4" />
            </div>
          </TileContent>
        </Tile>
      ))}
    </div>
  </div>
</PortalLayout>

{/* GTM: portal landing page view */}
<script>
  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push({ event: "portal_landing_view" });
</script>

---
import Layout from '@/layouts/Layout.astro';
import { getAllSponsors } from '@/lib/sanity';
import { Section, SectionContent, SectionGrid } from '@/components/ui/section';
import { Tile, TileContent, TileTitle, TileDescription } from '@/components/ui/tile';
import { Badge } from '@/components/ui/badge';
import { Icon } from '@/components/ui/icon';
import { stegaClean } from '@sanity/client/stega';
import { urlFor } from '@/lib/image';
import type { Sponsor } from '@/lib/sanity';

function sponsorLogoUrl(logo: Sponsor['logo']) {
  return logo ? urlFor(logo as unknown as Parameters<typeof urlFor>[0]).width(112).height(112).url() : null;
}

const sponsors = await getAllSponsors();

const tierStyles: Record<string, { border: string; badge: string }> = {
  platinum: { border: 'border-foreground', badge: 'bg-foreground text-background border-foreground' },
  gold: { border: 'border-njit-gold', badge: 'bg-njit-gold text-foreground border-njit-gold' },
  silver: { border: 'border-muted-foreground', badge: 'bg-muted-foreground text-background border-muted-foreground' },
  bronze: { border: 'border-amber-700', badge: 'bg-amber-700 text-background border-amber-700' },
};
---

<Layout title="Sponsors">
  <Section>
    <SectionContent>
      <h1 class="text-4xl md:text-5xl font-bold tracking-[-0.03em] leading-[1.05]">Our Sponsors</h1>
    </SectionContent>

    <SectionGrid size="lg">
      {sponsors.map((sponsor) => {
        const tier = tierStyles[stegaClean(sponsor.tier) || 'silver'];
        const logoUrl = sponsorLogoUrl(sponsor.logo);
        return (
          <Tile variant="floating" class={`${tier.border} border-2 hover:-translate-y-1 hover:shadow-[8px_8px_0_0_rgba(0,0,0,1)] transition-all duration-150`}>
            <TileContent>
              <div class="flex items-start justify-between gap-4">
                <a href={`/sponsors/${sponsor.slug}`} class="flex items-center gap-4 no-underline text-inherit">
                  <div class="w-14 h-14 bg-muted flex items-center justify-center flex-shrink-0 border border-border overflow-hidden">
                    {logoUrl ? (
                      <img src={logoUrl} alt={sponsor.logo?.alt || `${sponsor.name} logo`} class="w-full h-full object-cover" loading="lazy" />
                    ) : (
                      <span class="text-lg font-bold text-muted-foreground">
                        {(sponsor.name || '').split(' ').map((w: string) => w[0]).join('').slice(0, 2)}
                      </span>
                    )}
                  </div>
                  <div>
                    <TileTitle class="text-xl">{sponsor.name}</TileTitle>
                  </div>
                </a>
                {sponsor.tier && (
                  <Badge class={tier.badge}>{sponsor.tier}</Badge>
                )}
              </div>

              {sponsor.description && (
                <TileDescription>{sponsor.description}</TileDescription>
              )}

              {sponsor.website && (
                <a
                  href={sponsor.website}
                  target="_blank"
                  rel="noopener"
                  class="text-xs font-bold uppercase tracking-wider text-primary hover:text-primary/80 inline-flex items-center gap-2"
                >
                  Visit Website
                  <Icon name="lucide:arrow-up-right" class="w-3.5 h-3.5" />
                </a>
              )}
            </TileContent>
          </Tile>
        );
      })}
    </SectionGrid>
  </Section>
</Layout>

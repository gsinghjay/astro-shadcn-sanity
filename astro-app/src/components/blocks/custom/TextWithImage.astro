---
import type { TextWithImageBlock } from '@/lib/types';
import { Section, SectionSplit, SectionContent, SectionMedia } from '@/components/ui/section';
import { PortableText } from 'astro-portabletext';
import { portableTextComponents } from '@/components/portable-text';
import { stegaClean } from '@sanity/client/stega';
import { urlFor } from '@/lib/image';
import type { Image } from '@sanity/types';

interface Props extends TextWithImageBlock {
  class?: string;
  id?: string;
}

const { heading, content, image, imagePosition } = Astro.props;
const isRight = stegaClean(imagePosition) !== 'left';
const imgSrc = image?.asset
  ? urlFor(image as unknown as Image).width(800).height(600).fit('crop').url()
  : null;
const lqip = image?.asset?.metadata?.lqip;
---

<Section data-animate>
  <SectionSplit>
    <SectionContent class="justify-center">
      {heading && (
        <h2 class="text-3xl md:text-4xl font-bold tracking-[-0.03em] leading-[1.1]">{heading}</h2>
      )}
      {content && (
        <div class="text-muted-foreground leading-relaxed prose">
          <PortableText value={content} components={portableTextComponents} />
        </div>
      )}
    </SectionContent>

    <SectionMedia class={`aspect-[4/3] ${!isRight ? '@lg:order-first' : ''}`}>
      {imgSrc && lqip ? (
        <div style={`background-image: url(${lqip}); background-size: cover;`}>
          <img
            src={imgSrc}
            alt={image?.alt || heading || ''}
            width={800}
            height={600}
            class="w-full h-full object-cover"
            loading="lazy"
            decoding="async"
          />
        </div>
      ) : imgSrc ? (
        <img
          src={imgSrc}
          alt={image?.alt || heading || ''}
          width={800}
          height={600}
          class="w-full h-full object-cover"
          loading="lazy"
          decoding="async"
        />
      ) : null}
    </SectionMedia>
  </SectionSplit>
</Section>

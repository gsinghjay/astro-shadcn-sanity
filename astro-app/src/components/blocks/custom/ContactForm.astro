---
import type { ContactFormBlock } from '@/lib/types';
import { Section, SectionSplit, SectionContent } from '@/components/ui/section';
import { Field, FieldLabel, FieldContent } from '@/components/ui/field';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { NativeSelect, NativeSelectOption } from '@/components/ui/native-select';
import { Button } from '@/components/ui/button';
import { Icon } from '@/components/ui/icon';

interface Props extends ContactFormBlock {
  class?: string;
  id?: string;
}

const { heading, description, successMessage } = Astro.props;

interface FormField {
  _key: string;
  name: string;
  label: string;
  type: 'text' | 'email' | 'textarea' | 'select';
  required: boolean;
  placeholder?: string;
  options?: string[];
}

const formFields: FormField[] = [
  { _key: 'f1', name: 'name', label: 'Full Name', type: 'text', required: true },
  { _key: 'f2', name: 'email', label: 'Email', type: 'email', required: true },
  { _key: 'f3', name: 'message', label: 'Message', type: 'textarea', required: true },
];
---

<Section data-animate>
  <SectionSplit>
    <SectionContent class="justify-center">
      {heading && (
        <h2 class="text-3xl md:text-4xl font-bold tracking-[-0.03em] leading-[1.1]">{heading}</h2>
      )}
      {description && (
        <p class="text-muted-foreground leading-relaxed">{description}</p>
      )}
    </SectionContent>

    <form data-contact-form data-gtm-form="contact" class="border-2 border-foreground p-8 md:p-12">
      <div data-form-fields class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {formFields.map((field) => {
          const isFullWidth = field.type === 'textarea' || field.type === 'select';
          return (
            <Field class={isFullWidth ? 'md:col-span-2' : ''}>
              <FieldLabel for={field.name}>
                {field.label}
                {field.required && <span class="text-primary ml-1">*</span>}
              </FieldLabel>
              <FieldContent>
                {field.type === 'textarea' ? (
                  <Textarea
                    id={field.name}
                    name={field.name}
                    required={field.required}
                    placeholder={field.placeholder || ''}
                    rows={5}
                  />
                ) : field.type === 'select' ? (
                  <div class="w-full [&_[data-slot=native-select-wrapper]]:w-full">
                    <NativeSelect id={field.name} name={field.name} required={field.required} class="w-full">
                      <NativeSelectOption value="">Select an option</NativeSelectOption>
                      {field.options?.map((opt) => (
                        <NativeSelectOption value={opt}>{opt}</NativeSelectOption>
                      ))}
                    </NativeSelect>
                  </div>
                ) : (
                  <Input
                    id={field.name}
                    type={field.type as 'text' | 'email'}
                    name={field.name}
                    required={field.required}
                    placeholder={field.placeholder || ''}
                  />
                )}
              </FieldContent>
            </Field>
          );
        })}

        <div class="md:col-span-2 pt-2">
          <Button type="submit" class="w-full md:w-auto">Submit Inquiry</Button>
        </div>
      </div>

      <div
        data-form-success
        class="text-center py-12"
      >
        <div class="w-16 h-16 bg-primary flex items-center justify-center mx-auto mb-6">
          <Icon name="lucide:check" class="w-8 h-8 text-primary-foreground" />
        </div>
        <h3 class="text-2xl font-bold mb-3">Inquiry Received</h3>
        <p class="text-muted-foreground">{successMessage || 'Thank you for your inquiry. We will get back to you shortly.'}</p>
      </div>
    </form>
  </SectionSplit>
</Section>

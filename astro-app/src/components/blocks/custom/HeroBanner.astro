---
import type { HeroBannerBlock } from '@/lib/types';
import { Section, SectionContent, SectionActions } from '@/components/ui/section';
import { Button } from '@/components/ui/button';
import { stegaClean } from '@sanity/client/stega';

interface Props extends HeroBannerBlock {
  class?: string;
  id?: string;
}

const { heading, subheading, ctaButtons, backgroundImages, alignment } = Astro.props;
const isCentered = stegaClean(alignment) === 'center';
const hasCarousel = backgroundImages && backgroundImages.length > 0;
---

<Section size="lg" class="bg-foreground text-background overflow-hidden relative group" data-animate>
  {hasCarousel && (
    <div class="hero-carousel absolute inset-0" data-carousel>
      {backgroundImages?.map((image, index) => (
        <div
          class="hero-carousel-slide absolute inset-0 transition-opacity duration-1000"
          data-slide={index}
          data-state={index === 0 ? 'active' : 'inactive'}
        >
          <img
            src={image.asset?.url || ''}
            alt={image.alt || `Slide ${index + 1}`}
            class="w-full h-full object-cover"
          />
          <div class="absolute inset-0 bg-foreground/60"></div>
        </div>
      ))}
      <div class="hero-carousel-nav absolute bottom-8 left-1/2 -translate-x-1/2 z-10 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
        {backgroundImages?.map((_, index) => (
          <button
            class="hero-carousel-dot h-2 rounded-full transition-all duration-300"
            data-dot={index}
            data-state={index === 0 ? 'active' : 'inactive'}
            aria-label={`Go to slide ${index + 1}`}
          />
        ))}
      </div>
    </div>
  )}

  <SectionContent class={`relative z-10 ${isCentered ? 'items-center text-center' : ''} bg-foreground/80 backdrop-blur-sm p-8 md:p-12 rounded-lg`}>
    <h1 class="text-5xl md:text-7xl lg:text-8xl font-bold leading-[0.95] tracking-[-0.04em]">
      {heading}
    </h1>

    {subheading && (
      <p class={`text-lg md:text-xl text-background/60 leading-relaxed ${isCentered ? 'max-w-2xl' : 'max-w-2xl'}`}>
        {subheading}
      </p>
    )}

    {ctaButtons && ctaButtons.length > 0 && (
      <SectionActions class={isCentered ? 'justify-center' : ''}>
        {ctaButtons.map((btn, i) => (
          <Button
            href={btn.url}
            variant={i === 0 ? 'default' : (btn.variant || 'outline')}
            class={i > 0 ? 'bg-transparent border-background text-background hover:bg-background hover:text-foreground' : ''}
            data-gtm-category="cta"
            data-gtm-action="click"
            data-gtm-label={stegaClean(btn.text)}
          >
            {btn.text}
          </Button>
        ))}
      </SectionActions>
    )}
  </SectionContent>
  <div class="absolute bottom-0 left-0 right-0 h-px bg-primary z-10"></div>
</Section>

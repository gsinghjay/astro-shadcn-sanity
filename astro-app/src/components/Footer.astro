---
import { getSiteSettings } from '../lib/sanity';
import { stegaClean } from '@sanity/client/stega';
import {
  Footer as FooterUI,
  FooterDescription,
  FooterGroup,
  FooterGroupLabel,
  FooterMenu,
  FooterMenuItem,
  FooterMenuLink,
  FooterCopyright,
  FooterSpread,
} from '@/components/ui/footer';
import { Logo, LogoText } from '@/components/ui/logo';
import { Icon } from '@/components/ui/icon';

const settings = await getSiteSettings();
const {
  siteName,
  siteDescription,
  logoLight,
  footerContent,
  programLinks,
  resourceLinks,
  contactInfo,
  footerLinks,
  socialLinks,
} = settings;

const footerLogoUrl = logoLight?.asset?.url || '/logos/njit-logo-plain-light.svg';
const footerLogoAlt = logoLight?.alt || 'NJIT';

// Split siteName for footer display
const nameParts = (siteName || 'YWCC Industry Capstone').split(' ');
const brandPrimary = nameParts[0];
const brandSecondary = nameParts.slice(1).join(' ');

// Split address into lines for display
const addressLines = contactInfo?.address ? contactInfo.address.split(', ') : [];
const addressLine1 = addressLines.slice(0, 2).join(', ');
const addressLine2 = addressLines.slice(2).join(', ');
---

<FooterUI class="bg-foreground text-background">
  <!-- Main Footer Content -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-12 lg:gap-8">
    <!-- About Section - Takes more space on desktop -->
    <div class="lg:col-span-4">
      <Logo href="/" class="mb-6">
        <img src={footerLogoUrl} alt={footerLogoAlt} class="h-10 w-auto" />
        <LogoText class="text-background">
          <span class="flex flex-col">
            <span class="text-sm font-bold uppercase tracking-widest leading-tight">{brandPrimary}</span>
            <span class="text-xs uppercase tracking-wider leading-tight opacity-60">{brandSecondary}</span>
          </span>
        </LogoText>
      </Logo>
      <FooterDescription class="text-background/60 leading-relaxed">
        {siteDescription || footerContent?.text || ''}
      </FooterDescription>
      {(socialLinks && socialLinks.length > 0) && (
        <div class="flex gap-4 mt-6">
          {socialLinks.map((link) => (
            <a
              href={link.url}
              target="_blank"
              rel="noopener"
              aria-label={link.platform}
              class="text-background/60 hover:text-background transition-colors text-xl"
              data-gtm-category="social"
              data-gtm-label={stegaClean(link.platform)}
            >
              <Icon href={link.url} />
            </a>
          ))}
        </div>
      )}
    </div>

    <!-- Programs Section -->
    <div class="lg:col-span-2">
      <FooterGroup>
        <FooterGroupLabel class="text-background/40 uppercase text-xs tracking-widest font-bold mb-4">Programs</FooterGroupLabel>
        <FooterMenu>
          {(programLinks || []).map((item) => (
            <FooterMenuItem>
              <FooterMenuLink href={item.href} class="text-background/80 hover:text-background transition-colors" data-gtm-category="footer" data-gtm-label={stegaClean(item.label)}>{item.label}</FooterMenuLink>
            </FooterMenuItem>
          ))}
        </FooterMenu>
      </FooterGroup>
    </div>

    <!-- Resources Section -->
    <div class="lg:col-span-2">
      <FooterGroup>
        <FooterGroupLabel class="text-background/40 uppercase text-xs tracking-widest font-bold mb-4">Resources</FooterGroupLabel>
        <FooterMenu>
          {(resourceLinks || []).map((item) => (
            <FooterMenuItem>
              <FooterMenuLink
                href={item.href}
                {...(item.external ? { target: '_blank', rel: 'noopener' } : {})}
                class="text-background/80 hover:text-background transition-colors"
                data-gtm-category="footer"
                data-gtm-label={stegaClean(item.label)}
              >{item.label}</FooterMenuLink>
            </FooterMenuItem>
          ))}
        </FooterMenu>
      </FooterGroup>
    </div>

    <!-- Contact Information -->
    <div class="lg:col-span-2">
      <FooterGroup>
        <FooterGroupLabel class="text-background/40 uppercase text-xs tracking-widest font-bold mb-4">Contact</FooterGroupLabel>
        <FooterMenu>
          {addressLine1 && (
            <FooterMenuItem>
              <span class="text-background/60 text-sm leading-relaxed">{addressLine1}</span>
            </FooterMenuItem>
          )}
          {addressLine2 && (
            <FooterMenuItem>
              <span class="text-background/60 text-sm leading-relaxed">{addressLine2}</span>
            </FooterMenuItem>
          )}
          {contactInfo?.email && (
            <FooterMenuItem>
              <FooterMenuLink href={`mailto:${contactInfo.email}`} class="text-background/80 hover:text-background transition-colors" data-gtm-category="footer" data-gtm-label="email">{contactInfo.email}</FooterMenuLink>
            </FooterMenuItem>
          )}
          {contactInfo?.phone && (
            <FooterMenuItem>
              <FooterMenuLink href={`tel:+1${contactInfo.phone.replace(/\D/g, '')}`} class="text-background/60 hover:text-background/80 text-sm transition-colors" data-gtm-category="footer" data-gtm-label="phone">{contactInfo.phone}</FooterMenuLink>
            </FooterMenuItem>
          )}
        </FooterMenu>
      </FooterGroup>
    </div>
  </div>

  <!-- Bottom Bar -->
  <FooterSpread class="border-t border-background/10 pt-8 mt-12">
    <FooterCopyright class="text-background/40 text-sm">&copy; {footerContent?.copyrightText || `${new Date().getFullYear()} All rights reserved.`}</FooterCopyright>
    <FooterMenu orientation="horizontal" class="flex-wrap justify-center md:justify-end">
      {(footerLinks || []).map((item) => (
        <FooterMenuItem>
          <FooterMenuLink
            href={item.href}
            {...((item.href || '').startsWith('http') ? { target: '_blank', rel: 'noopener' } : {})}
            class="text-background/40 hover:text-background text-xs transition-colors"
            data-gtm-category="footer"
            data-gtm-label={stegaClean(item.label)}
          >{item.label}</FooterMenuLink>
        </FooterMenuItem>
      ))}
    </FooterMenu>
  </FooterSpread>
</FooterUI>

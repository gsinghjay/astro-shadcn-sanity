# Requires: cp astro-app/.env.example astro-app/.env && cp studio/.env.example studio/.env

services:
  astro-app:
    build:
      context: .
      target: dev-astro
    ports:
      - "4321:4321"
    volumes:
      - .:/app
      - node_modules:/app/node_modules
      - astro_node_modules:/app/astro-app/node_modules
      - studio_node_modules:/app/studio/node_modules
    env_file:
      - astro-app/.env
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true

  studio:
    build:
      context: .
      target: dev-studio
    ports:
      - "3333:3333"
    volumes:
      - .:/app
      - node_modules:/app/node_modules
      - astro_node_modules:/app/astro-app/node_modules
      - studio_node_modules:/app/studio/node_modules
    env_file:
      - studio/.env
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true

  astro-rwc-us:
    build:
      context: .
      target: dev-astro
    ports:
      - "4322:4321"
    volumes:
      - .:/app
      - node_modules:/app/node_modules
      - astro_node_modules:/app/astro-app/node_modules
      - studio_node_modules:/app/studio/node_modules
    env_file:
      - astro-app/.env
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true
      - PUBLIC_SANITY_DATASET=rwc
      - PUBLIC_SITE_ID=rwc-us
      - PUBLIC_SITE_THEME=blue
      - PUBLIC_SITE_URL=http://localhost:4322
    profiles:
      - rwc

  astro-rwc-intl:
    build:
      context: .
      target: dev-astro
    ports:
      - "4323:4321"
    volumes:
      - .:/app
      - node_modules:/app/node_modules
      - astro_node_modules:/app/astro-app/node_modules
      - studio_node_modules:/app/studio/node_modules
    env_file:
      - astro-app/.env
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true
      - PUBLIC_SANITY_DATASET=rwc
      - PUBLIC_SITE_ID=rwc-intl
      - PUBLIC_SITE_THEME=green
      - PUBLIC_SITE_URL=http://localhost:4323
    profiles:
      - rwc

  storybook:
    build:
      context: .
      target: dev-storybook
    ports:
      - "6006:6006"
    volumes:
      - .:/app
      - node_modules:/app/node_modules
      - astro_node_modules:/app/astro-app/node_modules
      - studio_node_modules:/app/studio/node_modules
    env_file:
      - astro-app/.env
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true
    profiles:
      - storybook

volumes:
  node_modules:
  astro_node_modules:
  studio_node_modules:
